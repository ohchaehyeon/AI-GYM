<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<script type="text/javascript"
   src="https://unpkg.com/webcam-easy/dist/webcam-easy.min.js"></script>
<script type="text/javascript"
   src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.11.0/dist/tf.min.js"></script>
<script
   src="https://cdn.jsdelivr.net/npm/@tensorflow-models/posenet@2.2.2/dist/posenet.min.js"></script>

</head>
<body>
   <video id="webcam" autoplay playsinline width="640" height="480"></video>
   <canvas id="canvas" class="d-none"></canvas>
   <audio id="snapSound" preload="auto"></audio>
   <div id="btn-capture">GOTCHA!</div>
</body>

<script>

   const snapBtn = document.getElementById("btn-capture")

   const webcamElement = document.getElementById('webcam');
   const canvasElement = document.getElementById('canvas');
   const snapSoundElement = document.getElementById('snapSound');
   const webcam = new Webcam(webcamElement, 'user', canvasElement, snapSoundElement);
   const context = canvasElement.getContext("2d");
   webcam.start()
   .then(result =>{
      console.log("webcam started");
   })
   .catch(err => {
       console.log(err);
   });
   snapBtn.onclick = () => {
        const picture = webcam.snap();
        start();
   }
   
   const start = async function() {
	   const model = await tf.loadLayersModel('http://localhost:8080/model/load');
      /* const model = await tf.loadLayersModel('./model/model.json'); */
      let img = tf.browser.fromPixels(webcamElement); 
      console.log(model);
      row = []
      posenet.load().then(function (net) {
          const pose = net.estimateSinglePose(img, {
               flipHorizontal: false
           });
           return pose;
           }).then(function (pose) {
               
                // drawKeypoints(pose.keypoints, 0.6, context);
                // drawSkeleton(pose.keypoints, 0.6, context);

                for (var i = 0; i < pose.keypoints.length; i++) {
                   row.push(pose.keypoints[i].position.x)
                   row.push(pose.keypoints[i].position.y)
                   row.push(pose.keypoints[i].score)
               }
                row.push(canvasElement.height)
                row.push(canvasElement.width)
                row.push(pose.score)
                // console.log(row)
                const enc_Data = tf.tensor([row])
                // console.log(enc_Data)
                let prediction = model.predict(enc_Data); 
                console.log(prediction.array());
   
   
           })
            
            
      }
   
</script>

<!-- <script src="posenet.js"></script> -->

</html>